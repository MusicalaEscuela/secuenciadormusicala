<!doctype html>
<html lang="es-CO">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>Caja de Ritmos + Partitura ¬∑ Musicala</title>
  <meta name="description" content="Caja de ritmos pedag√≥gica con rejilla por pasos y partitura r√≠tmica generada con VexFlow." />
  <meta name="theme-color" content="#ffffff" />
  <meta name="color-scheme" content="light" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- iOS / PWA (opcional: deja listo para futuro) -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <!-- <link rel="manifest" href="./manifest.webmanifest" /> -->
  <!-- <link rel="icon" href="./icons/icon-192.png" sizes="192x192" /> -->
  <!-- <link rel="apple-touch-icon" href="./icons/icon-192.png" /> -->

  <!-- Fuente (con preload para menos FOUT) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" as="style"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

  <!-- CSS del proyecto -->
  <link rel="stylesheet" href="./css/styles.css" />

  <!-- Fallback m√≠nimo por si tu CSS no carga/est√° incompleto -->
  <style>
    :root { color-scheme: light; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #fff;
      color: #0f172a;
    }

    /* Notaci√≥n VexFlow: contenedor scrolleable si el SVG queda ancho */
    #notation { width: 100%; overflow-x: auto; overflow-y: hidden; }
    #notation svg { display: block; height: auto; }

    /* A11y */
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px;
      overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }

    /* Fallback suave para evitar layout raro si styles.css no est√° */
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px; }
    .panel { margin-top: 16px; }
    .notation-card { border-radius: 16px; padding: 12px; border: 1px solid rgba(15,23,42,.08); background: rgba(255,255,255,.8); }
  </style>
</head>

<body>
  <main id="app" class="wrap">
    <!-- Header -->
    <header class="app-header" role="banner">
      <img class="app-logo" src="./assets/logo.png" alt="Musicala" />
      <div class="app-header__text">
        <h1 class="app-title">Caja de ritmos ü•Å</h1>
        <p class="app-subtitle">Rejilla por pasos + partitura generada autom√°ticamente.</p>
      </div>
    </header>

    <!-- Toolbar -->
    <section class="toolbar" aria-label="Controles de reproducci√≥n">
      <div class="toolbar__group">
        <button id="playBtn" class="btn primary" type="button" aria-pressed="false">
          ‚ñ∂ Reproducir
        </button>

        <label class="label" for="bpmInput">BPM</label>
        <input
          id="bpmInput"
          class="input input--bpm"
          type="number"
          min="40"
          max="240"
          step="1"
          value="90"
          inputmode="numeric"
          autocomplete="off"
          aria-describedby="bpmHelp"
        />
        <span id="bpmHelp" class="sr-only">BPM entre 40 y 240</span>

        <button id="clearBtn" class="btn" type="button">
          Limpiar
        </button>
      </div>

      <div class="toolbar__group" aria-label="Presets">
        <button id="rockBtn" class="btn" type="button">Ritmo rock</button>
        <button id="funkBtn" class="btn" type="button">Ritmo funk</button>
      </div>

      <div class="toolbar__spacer" aria-hidden="true"></div>

      <div id="statusText" class="label" aria-live="polite"></div>
    </section>

    <!-- Panel Grid -->
    <section class="panel" aria-label="Rejilla de bater√≠a">
      <h2 class="panel__title">Rejilla</h2>
      <p class="panel__subtitle">16 pasos (semicorcheas) ¬∑ 1 comp√°s 4/4</p>

      <div class="grid-wrap">
        <div
          id="drumGrid"
          class="drum-grid"
          role="application"
          aria-label="Rejilla por pasos"
          aria-describedby="a11yHint"
        ></div>
      </div>
    </section>

    <!-- Panel Notaci√≥n -->
    <section class="panel" aria-label="Partitura generada">
      <h2 class="panel__title">Partitura (VexFlow)</h2>
      <p class="panel__subtitle">Se actualiza solo cuando cambias el patr√≥n.</p>

      <div id="notationWrap" class="notation-card">
        <!-- IMPORTANT√çSIMO:
             Esto debe ser un DIV. VexFlow crea su SVG adentro. -->
        <div id="notation" role="img" aria-label="Partitura"></div>
      </div>
    </section>

    <p class="sr-only" id="a11yHint">
      Usa la rejilla para activar o desactivar golpes. La partitura se actualiza autom√°ticamente.
    </p>

    <!-- Si el usuario tiene JS apagado (pasa, incre√≠blemente) -->
    <noscript>
      <p style="padding:12px;border:1px solid rgba(15,23,42,.15);border-radius:12px;">
        Esta herramienta necesita JavaScript para funcionar.
      </p>
    </noscript>
  </main>

  <!-- Vendor (cargan antes de tus m√≥dulos) -->
  <!-- Tone.js (audio) -->
  <script src="https://unpkg.com/tone@14.7.77/build/Tone.js" defer></script>

  <!-- VexFlow (notaci√≥n) -->
  <script src="https://unpkg.com/vexflow@4.2.5/build/cjs/vexflow.js" defer></script>

  <!-- App scripts (orden l√≥gico de dependencias) -->
  <script src="./js/utils.js" defer></script>
  <script src="./js/state.js" defer></script>
  <script src="./js/presets.js" defer></script>
  <script src="./js/grid.js" defer></script>
  <script src="./js/notation.js" defer></script>
  <script src="./js/audio.js" defer></script>
  <script src="./js/app.js" defer></script>
</body>
</html>